{
  "$schema": "node_modules/wrangler/config-schema.json",

  // === App identity ===
  "name": "codr-agent-cde-sdk",
  "main": "src/worker.ts",
  "compatibility_date": "2025-10-23",
  "compatibility_flags": ["nodejs_compat"],

  // === Static UI ===
  "assets": {
    "directory": "web",
    "binding": "ASSETS",
    "run_worker_first": true
  },

  // === Observability ===
  "observability": { "enabled": true },

  // === Durable Object (resume-in-progress) ===
  "durable_objects": {
    "bindings": [
      { "name": "AGENT_STATE", "class_name": "AgentStateDO" }
    ]
  },

  // First-time DO class registration
  "migrations": [
    { "tag": "v1_agent_state", "new_classes": ["AgentStateDO"] }
  ],

  // === Dispatcher (platform calls per-user Workers) ===
  // "dispatch_namespaces": [
  //   {
  //     "binding": "DISPATCHER",
  //     "namespace": "codr-default-namespace",
  //     "remote": true
  //   }
  // ],

  // === Data bindings ===
  "kv_namespaces": [
    { "binding": "AGENT_CACHE" }
  ],
  "d1_databases": [
    {
      "binding": "AGENT_REGISTRY_DB",
      "database_name": "agent_registry_db",
      // ðŸ‘‡ This makes deploy auto-run your SQL files in /src/migrations
      "migrations_dir": "src/migrations"
    }
  ],
  "r2_buckets": [
    { "binding": "AGENT_ASSETS", "bucket_name": "agent-assets-bucket" }
  ],

  // === Workers AI (available; routed via your gateway) ===
  "ai": { "binding": "AI", "remote": true },

  // === Routes/domain ===
  // Leave empty so the Deploy-to-Cloudflare flow prompts and wires DNS.
  "workers_dev": false,
  "routes": [],

  // === Runtime vars ===
  // Pre-filled per your preference; Dashboard can still override.
  "vars": {
    "CLOUDFLARE_AI_GATEWAY": "codr-gateway",
    "GOOGLE_AI_STUDIO_API_KEY": "",

    "CUSTOM_DOMAIN": "",
    "ALLOWED_EMAIL": "",
    "MAX_SANDBOX_INSTANCES": "10",
    "SANDBOX_INSTANCE_TYPE": "standard-3",
    "LOG_LEVEL": "info",
    "KV_TTL_SECONDS": "86400"
  },

  "preview_urls": false
}
